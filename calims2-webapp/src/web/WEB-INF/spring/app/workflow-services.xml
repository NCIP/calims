<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" 
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
       xmlns:aop="http://www.springframework.org/schema/aop" 
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:jee="http://www.springframework.org/schema/jee"
       xmlns:p="http://www.springframework.org/schema/p"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
        http://www.springframework.org/schema/aop 
        http://www.springframework.org/schema/aop/spring-aop-3.0.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context-3.0.xsd
        http://www.springframework.org/schema/jee 
        http://www.springframework.org/schema/jee/spring-jee-3.0.xsd
        http://www.springframework.org/schema/tx 
        http://www.springframework.org/schema/tx/spring-tx-3.0.xsd 
        http://www.springframework.org/schema/util 
        http://www.springframework.org/schema/util/spring-util-3.0.xsd"
        >
    
  <bean id="approvalService" class="gov.nih.nci.calims2.business.generic.GenericServiceImpl">
    <property name="allowedQueryNamePrefix" value="gov.nih.nci.calims2.domain.workflow.Approval." />
    <property name="crudEventListener">
      <bean class="gov.nih.nci.calims2.business.generic.CompositeCRUDEventListener">
        <property name="listeners">
          <list>
            <ref bean="auditableCRUDEventListener"/>
          </list>
        </property> 
      </bean>
    </property>
    <property name="genericDao" ref="genericDao" />
    <property name="validator">
      <bean class="gov.nih.nci.calims2.business.workflow.approval.ApprovalValidator">
        <property name="validatorFactory" ref="validatorFactory"/>
      </bean>
    </property>
  </bean>  
      <!-- 
  <bean id="bamGenericDao" class="gov.nih.nci.calims2.dao.HibernateGenericDao">
    <property name="sessionFactory" ref="bamSessionFactory" />
  </bean>
        
  <bean id="bamLogger" class="gov.nih.nci.calims2.business.workflow.engine.BamLoggerImpl" >
    <property name="genericDao" ref="bamGenericDao"/>
  </bean>      
  
  <bean id="bamSessionFactory" class="org.springframework.orm.hibernate3.annotation.AnnotationSessionFactoryBean">
    <property name="dataSource" ref="dataSource"/>
    <property name="mappingLocations">
      <list>
        <value>classpath:/AuditLog.hbm.xml</value>
      </list>
    </property>
    <property name="namingStrategy">
      <bean class="gov.nih.nci.calims2.dao.naming.BAMNamingStrategy" />
    </property>
    <property name="hibernateProperties">
      <props>
        <prop key="cache.provider_class">org.hibernate.cache.NoCacheProvider</prop>
        <prop key="hibernate.format_sql">true</prop>
        <prop key="hibernate.show_sql">true</prop>
        <prop key="hibernate.use_sql_comments">true</prop> 
        <prop key="use_outer_join">true</prop>
        <prop key="hibernate.jdbc.batch_size">1024</prop>
        <prop key="hibernate.jdbc.fetch_size">1024</prop>
        <prop key="jta.UserTransaction">java:comp/UserTransaction</prop>
      </props>
    </property>
  </bean>
  
  <bean id="bpmEntityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"> 
    <property name="dataSource" ref="dataSource"/> 
    <property name="jpaProperties">
      <props>
        <prop key="hibernate.ejb.naming_strategy">gov.nih.nci.calims2.dao.naming.BPMNamingStrategy</prop>
      </props>
    </property>
    <property name="persistenceXmlLocation" value="classpath:/META-INF/bpm-persistence.xml" />
  </bean>
  
  <bean id="bpmGenericDao" class="gov.nih.nci.calims2.dao.JPAGenericDao">
    <property name="entityManagerFactory" ref="bpmEntityManagerFactory" />
  </bean>

  
 <bean id="experimentService" class="gov.nih.nci.calims2.business.generic.GenericServiceImpl">
    <property name="allowedQueryNamePrefix" value="gov.nih.nci.calims2.domain.workflow.Experiment." />
    <property name="crudEventListener">
      <bean class="gov.nih.nci.calims2.business.generic.CompositeCRUDEventListener">
        <property name="listeners">
          <list>
            <ref bean="auditableCRUDEventListener"/>
          </list>
        </property> 
      </bean>
    </property>
    <property name="genericDao" ref="genericDao" />
    <property name="validator">
      <bean class="gov.nih.nci.calims2.business.workflow.experiment.ExperimentValidator">
        <property name="validatorFactory" ref="validatorFactory"/>
      </bean>
    </property>
  </bean>
    -->
  <bean id="findingService" class="gov.nih.nci.calims2.business.generic.GenericServiceImpl">
    <property name="allowedQueryNamePrefix" value="gov.nih.nci.calims2.domain.workflow.Finding." />
    <property name="crudEventListener">
      <bean class="gov.nih.nci.calims2.business.generic.CompositeCRUDEventListener">
        <property name="listeners">
          <list>
            <ref bean="auditableCRUDEventListener"/>
          </list>
        </property> 
      </bean>
    </property>
    <property name="genericDao" ref="genericDao" />
    <property name="validator">
      <bean class="gov.nih.nci.calims2.business.workflow.finding.FindingValidator">
        <property name="validatorFactory" ref="validatorFactory"/>
      </bean>
    </property>
  </bean>
<!--  
  <bean id="processEngineService" class="gov.nih.nci.calims2.business.workflow.engine.ProcessEngineImpl" init-method="init" destroy-method="destroy" depends-on="sessionLoader, taskServer">
    <property name="bamLogger" ref="bamLogger" />
    <property name="bpmGenericDao" ref="bpmGenericDao" />
    <property name="entityManagerFactory" ref="bpmEntityManagerFactory" />
    <property name="sessionLoader" ref="sessionLoader" />
    <property name="transactionManager" ref="transactionManager" />
  </bean>
  -->
   <!--
 <bean id="processDesignService" class="gov.nih.nci.calims2.business.generic.GenericServiceImpl">
    <property name="allowedQueryNamePrefix" value="gov.nih.nci.calims2.domain.workflow.ProcessDesign." />
    <property name="crudEventListener">
      <bean class="gov.nih.nci.calims2.business.generic.CompositeCRUDEventListener">
        <property name="listeners">
          <list>
            <bean class="gov.nih.nci.calims2.business.workflow.processdesign.ProcessDesignCRUDEventListener">
              <property name="privilegeEvaluator" ref="privilegeEvaluator" />
              <property name="documentService" ref="documentService" />
            </bean>
          </list>
        </property> 
      </bean>
    </property>
    <property name="genericDao" ref="genericDao" />
    <property name="validator">
      <bean class="gov.nih.nci.calims2.business.workflow.processdesign.ProcessDesignValidator">
        <property name="validatorFactory" ref="validatorFactory"/>
      </bean>
    </property>
  </bean>
   --> 
   
  <bean id="projectService" class="gov.nih.nci.calims2.business.generic.GenericServiceImpl">
    <property name="allowedQueryNamePrefix" value="gov.nih.nci.calims2.domain.workflow.Project." />
    <property name="crudEventListener">
      <bean class="gov.nih.nci.calims2.business.generic.CompositeCRUDEventListener">
        <property name="listeners">
          <list>
            <ref bean="auditableCRUDEventListener"/>
          </list>
        </property> 
      </bean>
    </property>
    <property name="genericDao" ref="genericDao" />
    <property name="validator">
      <bean class="gov.nih.nci.calims2.business.workflow.project.ProjectValidator">
        <property name="validatorFactory" ref="validatorFactory"/>
      </bean>
    </property>
  </bean>
  
  <!-- 
  <bean id="sessionLoader" class="gov.nih.nci.calims2.business.workflow.engine.SessionLoaderImpl">
    <property name="bpmGenericDao" ref="bpmGenericDao" />
  </bean>
  
  <bean id="taskClientTemplate" class="gov.nih.nci.calims2.business.workflow.taskclient.TaskClientTemplate" >
    <property name="taskServerHostConfiguration" ref="taskServerHostConfiguration" />
  </bean>
  
  <bean id="taskEngine" class="gov.nih.nci.calims2.business.workflow.taskclient.TaskEngineImpl" depends-on="taskServer">
    <property name="taskClientTemplate" ref="taskClientTemplate"/>
  </bean>
  
  <bean id="taskEntityManagerFactory" class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean"> 
    <property name="dataSource" ref="dataSource"/> 
    <property name="jpaProperties">
      <props>
        <prop key="hibernate.ejb.naming_strategy">gov.nih.nci.calims2.dao.naming.TaskNamingStrategy</prop>
      </props>
    </property>
    <property name="persistenceXmlLocation" value="classpath:/META-INF/task-persistence.xml" />
  </bean>
  
  <bean id="taskGenericDao" class="gov.nih.nci.calims2.dao.JPAGenericDao">
    <property name="entityManagerFactory" ref="taskEntityManagerFactory" />
  </bean>
    
  <bean id="taskServer" class="gov.nih.nci.calims2.business.workflow.taskserver.TaskServer" init-method="init" destroy-method="destroy">
    <property name="entityManagerFactory" ref="taskEntityManagerFactory" />
    <property name="taskServerHostConfiguration" ref="taskServerHostConfiguration" />
  </bean>
  
  <bean id="taskServerHostConfiguration" class="gov.nih.nci.calims2.business.workflow.taskclient.TaskServerHostConfiguration">
    <property name="hostName" value="127.0.0.1" />
    <property name="port" value="9123" />
  </bean>
       --> 
</beans>        